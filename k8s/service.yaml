---
# BIZRA API Service
# LoadBalancer for external access
apiVersion: v1
kind: Service
metadata:
  name: bizra-api-service
  namespace: bizra-system
  labels:
    app: bizra-api
    app.kubernetes.io/name: bizra
    app.kubernetes.io/component: api
  annotations:
    prometheus.io/scrape: "true"
    prometheus.io/port: "8000"
    service.beta.kubernetes.io/aws-load-balancer-type: "nlb"
    service.beta.kubernetes.io/aws-load-balancer-cross-zone-load-balancing-enabled: "true"
spec:
  type: LoadBalancer
  selector:
    app: bizra-api
  ports:
    - name: http
      protocol: TCP
      port: 80
      targetPort: 8000
    - name: https
      protocol: TCP
      port: 443
      targetPort: 8000
  sessionAffinity: None
  externalTrafficPolicy: Local
---
# Internal ClusterIP Service (for internal communication)
apiVersion: v1
kind: Service
metadata:
  name: bizra-api-internal
  namespace: bizra-system
  labels:
    app: bizra-api
    app.kubernetes.io/name: bizra
    app.kubernetes.io/component: api-internal
spec:
  type: ClusterIP
  selector:
    app: bizra-api
  ports:
    - name: http
      protocol: TCP
      port: 8000
      targetPort: 8000
---
# Headless Service (for StatefulSet discovery if needed)
apiVersion: v1
kind: Service
metadata:
  name: bizra-api-headless
  namespace: bizra-system
  labels:
    app: bizra-api
    app.kubernetes.io/name: bizra
    app.kubernetes.io/component: api-headless
spec:
  type: ClusterIP
  clusterIP: None
  selector:
    app: bizra-api
  ports:
    - name: http
      protocol: TCP
      port: 8000
      targetPort: 8000
---
# Neo4j Service
apiVersion: v1
kind: Service
metadata:
  name: neo4j-service
  namespace: bizra-system
  labels:
    app: neo4j
    app.kubernetes.io/name: neo4j
    app.kubernetes.io/component: database
spec:
  type: ClusterIP
  selector:
    app: neo4j
  ports:
    - name: bolt
      protocol: TCP
      port: 7687
      targetPort: 7687
    - name: http
      protocol: TCP
      port: 7474
      targetPort: 7474
    - name: metrics
      protocol: TCP
      port: 2004
      targetPort: 2004
---
# Redis Service
apiVersion: v1
kind: Service
metadata:
  name: redis-service
  namespace: bizra-system
  labels:
    app: redis
    app.kubernetes.io/name: redis
    app.kubernetes.io/component: cache
spec:
  type: ClusterIP
  selector:
    app: redis
  ports:
    - name: redis
      protocol: TCP
      port: 6379
      targetPort: 6379
    - name: metrics
      protocol: TCP
      port: 9121
      targetPort: 9121
---
# Prometheus Service
apiVersion: v1
kind: Service
metadata:
  name: prometheus-service
  namespace: bizra-system
  labels:
    app: prometheus
    app.kubernetes.io/name: prometheus
    app.kubernetes.io/component: monitoring
spec:
  type: ClusterIP
  selector:
    app: prometheus
  ports:
    - name: http
      protocol: TCP
      port: 9090
      targetPort: 9090
---
# Grafana Service
apiVersion: v1
kind: Service
metadata:
  name: grafana-service
  namespace: bizra-system
  labels:
    app: grafana
    app.kubernetes.io/name: grafana
    app.kubernetes.io/component: visualization
spec:
  type: LoadBalancer
  selector:
    app: grafana
  ports:
    - name: http
      protocol: TCP
      port: 3000
      targetPort: 3000
